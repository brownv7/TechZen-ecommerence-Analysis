/*
------------------------------
SQL Project - DotDash Analysis
------------------------------
*/

--1) What were the order counts, sales, and AOV for Macbooks sold in North America for each quarter across all years? 


select date_trunc(orders.purchase_ts, quarter) as purchase_quarter,
  count(distinct orders.id) as order_count,
  round(sum(orders.usd_price),2) as total_sales,
  round(avg(orders.usd_price),2) as aov
from core.orders
left join core.customers
  on orders.customer_id = customers.id
left join core.geo_lookup 
  on customers.country_code = geo_lookup.country
where lower(orders.product_name) like '%macbook%'
	and region = 'NA'
group by 1
order by 1 desc
